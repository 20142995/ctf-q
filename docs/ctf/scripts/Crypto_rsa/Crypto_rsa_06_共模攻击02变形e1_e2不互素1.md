## 共模攻击变形 gcd(e1,e2)!=1

http://www.zbc53.top/archives/148/

```
n:
31934670515243135376544494777800167818741680889482357476043664101552263846965902709062687560949362947553749723524721435747896957912492147193043671762758273928557874925637788128125234989097054621581308987239271864314404632159582139228882592627148471549398446422733460548334634327481394478107361389915143539547418985910098660767096947132861742818924085617776838873128115919283348588325931648893539577018391628362088644594757514603575697434296673391737253417736818781989856674787549446853432501840734261821542854584122792474217519456831119992972697291491227130606752323868696432108995904433
c1:
30844012039330070258536456143761809358862057797854053892630858440607549827193033460787087324464139605654012890812030144340209360634997046801933769493806658354096950161853154223654732670515647323259883550654904887690895032316338986275991996131184156035865626736143044052392910180192210388125839151242363611250480493837180613620038095895598448681833958215693745432776287627165112688548348416744866588794033023405575776579986490123103992662714442506606093897670878390187671611825093216814851078943446973697872672875998366847057357888052222683069587610459869062116880896250860882626078292958
c2:
29376289618101477573845080776626444563736469597151865167336042485301759536784462783567968526685694047477189187540318949323788697287596715848087482575926380828996111996259334495315493477987062604746359839578403800720962544133144995430614683984221525578746985707910306870258697864507359761731111650008286206169103341385599663639278442098324437911561465817861903840747109977213158732239774315834302674212907532925861990950343686568112047401696595811630295514183756734449163322948609350655620291947803969755100787417081253273154808178944403727535343569940717056601055016711889950898679773833
e1*e2=3087

```



一看就是共模攻击，$3087=3*3*7*7*7$,常见共模攻击当然是要$e_1,e_2$互素，所以第一想法是$e_1=3*3,e_2=7*7*7$,然后一做发现不对，回归共模攻击原理：

当$gcd(e_1,e_2)=1$,那么存在一组$(x,y)$使得$e_1x+e_2y=1$,

由此${c_1}^x{c_2}^y \equiv m^{e_1x}m^{e_2y} \equiv m^{e_1x+e_2y} \equiv m\%n$



广义化：存在一组$(x,y)$使得$e_1x+e_2y=gcd(e_1,e_2)$,同样地可以得到${c_1}^x{c_2}^y\equiv m^{gcd(e_1,e_2)}\%n$
此时若$gcd(e_1,e_2)$较小的话，可以直接考虑开方或者低指数攻击。
所以综上所述，需要遍历$e_1,e_2$的值，然后低指数攻击，猜测出题人界卡的应该挺好，所以设个一百万就差不多了，最后也是很快就出了。



```python
from gmpy2 import *
from Crypto.Util.number import *
 
 
n =31934670515243135376544494777800167818741680889482357476043664101552263846965902709062687560949362947553749723524721435747896957912492147193043671762758273928557874925637788128125234989097054621581308987239271864314404632159582139228882592627148471549398446422733460548334634327481394478107361389915143539547418985910098660767096947132861742818924085617776838873128115919283348588325931648893539577018391628362088644594757514603575697434296673391737253417736818781989856674787549446853432501840734261821542854584122792474217519456831119992972697291491227130606752323868696432108995904433
c1=30844012039330070258536456143761809358862057797854053892630858440607549827193033460787087324464139605654012890812030144340209360634997046801933769493806658354096950161853154223654732670515647323259883550654904887690895032316338986275991996131184156035865626736143044052392910180192210388125839151242363611250480493837180613620038095895598448681833958215693745432776287627165112688548348416744866588794033023405575776579986490123103992662714442506606093897670878390187671611825093216814851078943446973697872672875998366847057357888052222683069587610459869062116880896250860882626078292958
c2=29376289618101477573845080776626444563736469597151865167336042485301759536784462783567968526685694047477189187540318949323788697287596715848087482575926380828996111996259334495315493477987062604746359839578403800720962544133144995430614683984221525578746985707910306870258697864507359761731111650008286206169103341385599663639278442098324437911561465817861903840747109977213158732239774315834302674212907532925861990950343686568112047401696595811630295514183756734449163322948609350655620291947803969755100787417081253273154808178944403727535343569940717056601055016711889950898679773833
E=3087
fac=[3,3,7,7,7]
 
factor=[3,7,3*3,3*7,7*7,3*3*7,3*7*7,7*7*7,3*7*7*7,3*3*7*7]
for e1 in factor:
    assert E%e1==0
    e2=E//e1
    g=gcd(e1,e2)
    print(g)
    _,s,t=gcdext(e1,e2)
    M=pow(c1,s,n)*pow(c2,t,n)%n
    for k in range(1000000):
        a=iroot(M+k*n,g)
        if a[1]:
            print(long_to_bytes(a[0]))
            break
    #flag{g00d_jOB_on_th1s_Rs4_1ssuE_h4}

```



